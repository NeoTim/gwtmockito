<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>GwtMockito by google</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">GwtMockito</h1>
        <p class="header">Better GWT unit testing</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/google/gwtmockito/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/google/gwtmockito/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/google/gwtmockito">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/google">google</a></p>


      </header>
      <section>
        <h2>
<a id="what-is-gwtmockito" class="anchor" href="#what-is-gwtmockito" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is GwtMockito?</h2>

<p>Testing GWT applications using <code>GWTTestCase</code> can be a pain - it's slower than
using pure Java tests, and you can't use reflection-based tools like mocking
frameworks. But if you've tried to test widgets using normal test cases, you've
probably run into this error:</p>

<pre><code>ERROR: GWT.create() is only usable in client code!  It cannot be called,
for example, from server code. If you are running a unit test, check that 
your test case extends GWTTestCase and that GWT.create() is not called
from within an initializer or constructor.
</code></pre>

<p>GwtMockito solves this and other GWT-related testing problems by allowing you
to call GWT.create from JUnit tests, returning <a href="https://code.google.com/p/mockito/">Mockito</a> mocks.</p>

<h2>
<a id="how-do-i-use-it" class="anchor" href="#how-do-i-use-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How do I use it?</h2>

<p>Getting started with GwtMockito using Junit 4.5+ is easy. Just annotate your test
with <code>@RunWith(GwtMockitoTestRunner.class)</code>, then any calls to <code>GWT.create</code>
encountered will return Mockito mocks instead of throwing exceptions:</p>

<div class="highlight highlight-source-java"><pre>@RunWith(<span class="pl-smi">GwtMockitoTestRunner</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyTest</span> {
  <span class="pl-k">@Test</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">shouldReturnMocksFromGwtCreate</span>() {
    <span class="pl-smi">Label</span> myLabel <span class="pl-k">=</span> <span class="pl-c1">GWT</span><span class="pl-k">.</span>create(<span class="pl-smi">Label</span><span class="pl-k">.</span>class);
    when(myLabel<span class="pl-k">.</span>getText())<span class="pl-k">.</span>thenReturn(<span class="pl-s"><span class="pl-pds">"</span>some text<span class="pl-pds">"</span></span>);
    assertEquals(<span class="pl-s"><span class="pl-pds">"</span>some text<span class="pl-pds">"</span></span>, myLabel<span class="pl-k">.</span>getText());
  }
}</pre></div>

<p>GwtMockito also creates fake implementations of all UiBinders that automatically
populate <code>@UiField</code>s with Mockito mocks. Suppose you have a widget that looks
like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyWidget</span> <span class="pl-k">extends</span> <span class="pl-e">Composite</span> {
  <span class="pl-k">interface</span> <span class="pl-en">MyUiBinder</span> <span class="pl-k">extends</span> <span class="pl-e">UiBinder&lt;<span class="pl-smi">Widget</span>, <span class="pl-smi">MyWidget</span>&gt;</span> {}
  <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-smi">MyUiBinder</span> uiBinder <span class="pl-k">=</span> <span class="pl-c1">GWT</span><span class="pl-k">.</span>create(<span class="pl-smi">MyUiBinder</span><span class="pl-k">.</span>class);

  <span class="pl-k">@UiField</span> <span class="pl-smi">Label</span> numberLabel;
  <span class="pl-k">private</span> <span class="pl-k">final</span> <span class="pl-smi">NumberFormatter</span> formatter;

  <span class="pl-k">public</span> <span class="pl-en">MyWidget</span>(<span class="pl-smi">NumberFormatter</span> <span class="pl-v">formatter</span>) {
    <span class="pl-v">this</span><span class="pl-k">.</span>formatter <span class="pl-k">=</span> formatter;
    initWidget(uiBinder<span class="pl-k">.</span>createAndBindUi(<span class="pl-v">this</span>);
  }

  <span class="pl-k">void</span> setNumber(<span class="pl-k">int</span> number) {
    numberLabel<span class="pl-k">.</span>setText(formatter<span class="pl-k">.</span>format(number));
  }
}</pre></div>

<p>When <code>createAndBindUi</code> is called, GwtMockito will automatically populate 
<code>numberLabel</code> with a mock object. Since <code>@UiField</code>s are package-visible, they 
can be read from your unit tests, which lets you test this widget as follows:</p>

<div class="highlight highlight-source-java"><pre>@RunWith(<span class="pl-smi">GwtMockitoTestRunner</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyWidgetTest</span> {

  <span class="pl-k">@Mock</span> <span class="pl-smi">NumberFormatter</span> formatter;
  <span class="pl-k">private</span> <span class="pl-smi">MyWidget</span> widget;

  <span class="pl-k">@Before</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() {
    widget <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MyWidget</span>(formatter);
  }

  <span class="pl-k">@Test</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">shouldFormatNumber</span>() {
    when(formatter<span class="pl-k">.</span>format(<span class="pl-c1">5</span>))<span class="pl-k">.</span>thenReturn(<span class="pl-s"><span class="pl-pds">"</span>5.00<span class="pl-pds">"</span></span>);
    widget<span class="pl-k">.</span>setNumber(<span class="pl-c1">5</span>);
    verify(widget<span class="pl-k">.</span>numberLabel)<span class="pl-k">.</span>setText(<span class="pl-s"><span class="pl-pds">"</span>5.00<span class="pl-pds">"</span></span>);
  }
}</pre></div>

<p>Note that GwtMockito supports the <code>@Mock</code> annotation from Mockito, allowing 
standard Mockito mocks to be mixed with mocks created by GwtMockito.</p>

<p>That's all you need to know to get started - read on if you're interested in
hearing about some advanced features.</p>

<h3>
<a id="accessing-the-mock-returned-from-gwtcreate" class="anchor" href="#accessing-the-mock-returned-from-gwtcreate" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing the mock returned from GWT.create</h3>

<p>Returning mocks from <code>GWT.create</code> isn't very useful if you don't have any way to
verify or set behaviors on them. You can do this by annotating a field in your 
test with <code>@GwtMock</code> - this will cause all calls to <code>GWT.create</code> for that type
to return a mock stored in that field, allowing you to reference it in your
test. So if you have a class that looks like</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyClass</span> {
  <span class="pl-k">public</span> <span class="pl-en">MyClass</span>() {
    <span class="pl-smi">SomeInterface</span> myInterface <span class="pl-k">=</span> <span class="pl-c1">GWT</span><span class="pl-k">.</span>create(<span class="pl-smi">SomeInterface</span><span class="pl-k">.</span>class);
    myInterface<span class="pl-k">.</span>setSomething(<span class="pl-c1">true</span>);
  }
}</pre></div>

<p>then you can verify that it works correctly by writing a test that looks like
this:</p>

<div class="highlight highlight-source-java"><pre>@RunWith(<span class="pl-smi">GwtMockitoTestRunner</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyClassTest</span> {
  <span class="pl-k">@GwtMock</span> <span class="pl-smi">SomeInterface</span> mockInterface;

  <span class="pl-k">@Test</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">constructorShouldSetSomething</span>() {
    <span class="pl-k">new</span> <span class="pl-smi">MyClass</span>();
    verify(mockInterface)<span class="pl-k">.</span>setSomething(<span class="pl-c1">true</span>);
  }
}</pre></div>

<h3>
<a id="returning-fake-objects" class="anchor" href="#returning-fake-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning fake objects</h3>

<p>By default, GwtMockito will return fake implementations (which don't require you
to specify mock behavior) for any classes extending the following types:</p>

<ul>
<li>UiBinder</li>
<li>ClientBundle</li>
<li>Messages</li>
<li>CssResource</li>
<li>SafeHtmlTemplates</li>
</ul>

<p>You can add fakes for additional types by invoking 
<code>GwtMockito.useProviderForType(Class, FakeProvider)</code> in your <code>setUp</code> method. 
This will cause all calls to <code>GWT.create</code> for the given class or its subclasses
to invoke the given <code>FakeProvider</code> to determine what to return. See the
<a href="http://google.github.io/gwtmockito/javadoc/com/google/gwtmockito/GwtMockito.html#useProviderForType(java.lang.Class,%20com.google.gwtmockito.fakes.FakeProvider)">javadoc reference</a> for more details.</p>

<h3>
<a id="mocking-final-classes-and-methods" class="anchor" href="#mocking-final-classes-and-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking final classes and methods</h3>

<p>Mockito does not normally allow final classes and methods to be mocked. This 
poses problems in GWT since <a href="https://developers.google.com/web-toolkit/doc/latest/DevGuideCodingBasicsOverlay">JavaScript overlay types</a> (which include 
<code>Element</code> and its subclasses) require all methods to be final. Fortunately,
GwtMockito does some classloader black magic to remove all final modifiers from
classes and interfaces, so the following test will pass:</p>

<div class="highlight highlight-source-java"><pre>@RunWith(<span class="pl-smi">GwtMockitoTestRunner</span><span class="pl-k">.</span>class)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyTest</span> {
  <span class="pl-k">@Mock</span> <span class="pl-smi">Element</span> element;

  <span class="pl-k">@Test</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">shouldReturnMocksFromGwtCreate</span>() {
    when(element<span class="pl-k">.</span>getClassName())<span class="pl-k">.</span>thenReturn(<span class="pl-s"><span class="pl-pds">"</span>mockClass<span class="pl-pds">"</span></span>);
    assertEquals(<span class="pl-s"><span class="pl-pds">"</span>mockClass<span class="pl-pds">"</span></span>, myLabel<span class="pl-k">.</span>getClassName());
  }
}</pre></div>

<p>As long as your test uses <code>GwtMockitoTestRunner</code>, it is possible to mock any
final methods.</p>

<h3>
<a id="dealing-with-native-methods" class="anchor" href="#dealing-with-native-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dealing with native methods</h3>

<p>Under normal circumstances, JUnit tests will fail with an <code>UnsatisfiedLinkError</code> when encountering a native JSNI method. GwtMockito works around this problem
using more classloader black magic to provide no-op implementations for all
native methods using the following rules:</p>

<ul>
<li>
<code>void</code> methods do nothing.</li>
<li>Methods returning primitive types return the default value for that type (0,
false, etc.)</li>
<li>Methods returning <code>String</code>s return the empty string.</li>
<li>Methods returning other objects return a mock of that object configured with
<code>RETURNS_MOCKS</code>.</li>
</ul>

<p>These rules allow many tests to continue to work even when calling incindental
native methods. Note that this can be dangerous - a JSNI method that normally
always returns <code>true</code> would always return <code>false</code> when stubbed by GwtMockito.
As much as possible, you should isolate code that depends on JSNI into its own
class, <a href="http://en.wikipedia.org/wiki/Dependency_injection">inject</a> that class into yours, and test the factored-out class using
<code>GWTTestCase</code>.</p>

<h3>
<a id="support-for-junit-3-and-other-tests-that-cant-use-custom-runners" class="anchor" href="#support-for-junit-3-and-other-tests-that-cant-use-custom-runners" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support for JUnit 3 and other tests that can't use custom runners</h3>

<p>Though <code>GwtMockitoTestRunner</code> is the easiest way to use GwtMockito, it won't
work if you're using JUnit 3 or rely on another custom test runner. In these
situations, you can still get most of the benefit of GwtMockito by calling
<code>GwtMockito.initMocks</code> directly. A test written in this style looks like this:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyWidgetTest</span> <span class="pl-k">extends</span> <span class="pl-e">TestCase</span> {

  <span class="pl-k">private</span> <span class="pl-smi">MyWidget</span> widget;

  <span class="pl-k">@Override</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() {
    <span class="pl-v">super</span><span class="pl-k">.</span>setUp();
    <span class="pl-smi">GwtMockito</span><span class="pl-k">.</span>initMocks(<span class="pl-v">this</span>);
    widget <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MyWidget</span>() {
      <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">initWidget</span>(<span class="pl-smi">Widget</span> <span class="pl-v">w</span>) {
        <span class="pl-c">// Disarm for testing</span>
      }
    };
  }

  <span class="pl-k">@Override</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">tearDown</span>() {
    <span class="pl-v">super</span><span class="pl-k">.</span>tearDown();
    <span class="pl-smi">GwtMockito</span><span class="pl-k">.</span>tearDown();
  }

  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">testSomething</span>() {
    <span class="pl-c">// Test code goes here</span>
  }
}</pre></div>

<p>The test must explicitly call <code>initMocks</code> during its setup and <code>tearDown</code> when
it is being teared down, or else state can leak between tests. When 
instantiating a widget, the test must also subclass it and override initWidget
with a no-op implementation, or else it will fail when this method attempts to
call Javascript. Note that when testing in this way the features described in
"Mocking final classes and methods" and "Dealing with native methods" won't
work - there is no way to mock final methods or automatically replace native
methods without using <code>GwtMockitoTestRunner</code>.</p>

<h2>
<a id="how-do-i-install-it" class="anchor" href="#how-do-i-install-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How do I install it?</h2>

<p>If you're using Maven, you can add the following to your <code>&lt;dependencies&gt;</code>
section:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;com.google.gwt.gwtmockito&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;gwtmockito&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;1.1.6&lt;/<span class="pl-ent">version</span>&gt;
  &lt;<span class="pl-ent">scope</span>&gt;test&lt;/<span class="pl-ent">scope</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<p>You can also download the <a href="http://search.maven.org/remotecontent?filepath=com/google/gwt/gwtmockito/gwtmockito/1.1.6/gwtmockito-1.1.6.jar">jar</a> directly or check out the source using git
from <a href="https://github.com/google/gwtmockito.git">https://github.com/google/gwtmockito.git</a>. In these cases you will have
to manually install the jars for <a href="https://code.google.com/p/mockito/downloads/list">Mockito</a> and <a href="http://www.jboss.org/javassist/downloads">Javassist</a>.</p>

<h2>
<a id="where-can-i-learn-more" class="anchor" href="#where-can-i-learn-more" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Where can I learn more?</h2>

<ul>
<li>For more details on the GwtMockito API, consult the <a href="http://google.github.io/gwtmockito/javadoc/">Javadoc</a>
</li>
<li>For an example of using GwtMockito to test some example classes, see the
<a href="https://github.com/google/gwtmockito/tree/master/gwtmockito-sample/src">sample app</a>.</li>
</ul>

<h2>
<a id="version-history" class="anchor" href="#version-history" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version history</h2>

<h3>
<a id="116" class="anchor" href="#116" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.6</h3>

<ul>
<li>Improved support for running tests in IntelliJ.</li>
<li>Fix for stubbing DatePicker.</li>
<li>Better support for non-default classloaders. (Thanks to leanseefeld)</li>
<li>Depend on mockito-core instead of mockito-all. (Thanks to psiroky)</li>
</ul>

<h3>
<a id="115" class="anchor" href="#115" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.5</h3>

<ul>
<li>Support for JUnit 4.12. (Thanks to selesse)</li>
<li>Provide a better error message for <code>ClassCastException</code>s that we can't work around.</li>
<li>Support for JaCoCo. (Thanks to rsauciuc)</li>
<li>Include a fake implementation of <code>NumberConstants</code>.</li>
<li>Fixed support for <code>History</code> methods.</li>
<li>Fix for some <code>TextBox</code> methods.</li>
<li>Fix instantiation of checkboxes and radio buttons.</li>
</ul>

<h3>
<a id="114" class="anchor" href="#114" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.4</h3>

<ul>
<li>Many fixes for <code>ClassCastException</code>s when mocking various classes.</li>
<li>Support for Cobertura coverage tools. (Thanks to mvmn)</li>
<li>Try to intelligently return the right value for getTagName when possible.</li>
<li>Fixed a classloader delegation issue. (Thanks to paulduffin)</li>
<li>Add an annotation allowing the blacklist of classes that are always
loaded via the standard classloader to be specified on a per-test bases.</li>
</ul>

<h3>
<a id="113" class="anchor" href="#113" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.3</h3>

<ul>
<li>Support for Hamcrest matchers.</li>
<li>Added a method to specify packages that should never be reloaded.</li>
<li>Added a getFake method to provide direct access to registered fakes.</li>
<li>Fixed assertion errors in classes extending LabelBase.</li>
<li>Added an annotation allowing stubbed classes to be specified on a
per-test basis (suggested by danielkaneider)</li>
<li>Support for GWT 2.6.</li>
<li>Fix to allow FakeProviders to be specified for RPC interfaces.</li>
</ul>

<h3>
<a id="112" class="anchor" href="#112" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.2</h3>

<ul>
<li>Fix for UiBinders that generate parameterized widgets.</li>
<li>Fix to always use the most specific provider available when multiple
providers could provide a type. (Thanks to reimai)</li>
<li>Compatability with EMMA code coverage tools.</li>
</ul>

<h3>
<a id="111" class="anchor" href="#111" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.1</h3>

<ul>
<li>Fix for a bug in <code>AsyncAnswers</code>. (Thanks to tinamou)</li>
<li>Mock <code>@GwtMock</code> fields in superclasses the same way that Mockito does.
(Thanks to justinmk)</li>
<li>Fix for a conflict with PowerMock.</li>
</ul>

<h3>
<a id="110" class="anchor" href="#110" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.0</h3>

<ul>
<li>Support for GWT-RPC by returning mock async interfaces when GWT.creating
the synchronous interface</li>
<li>Support for testing widgets that expand Panel classes by automatically
stubbing Panel methods.</li>
<li>Ability to customize classes that are automatically stubbed in order to
support widgets extending third-party base classes.</li>
<li>Ability to customize the classloader and classpath used by GwtMockito for
better tool integration.</li>
<li>More flexible FakeProviders that allow the returned type to be unrelated
to the input type. <strong>Note that this can be a breaking change in some
cases: <code>getFake</code> should now just take a <code>Class&lt;?&gt;</code> instsead of a 
<code>Class&lt;? extends T&gt;</code></strong>. See <a href="https://github.com/google/gwtmockito/commit/52b5ddfc08df1b630cd1f241d2afaa08fed82a77">here</a> for an example.</li>
</ul>

<h3>
<a id="100" class="anchor" href="#100" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.0.0</h3>

<ul>
<li>Initial release</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-40935229-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
